# Prefix
set -g prefix C-a
set -g prefix2 C-b
bind C-a send-prefix

# Plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'mrjones2014/smart-splits.nvim'

set -g @resurrect-dir '~/.config/tmux/resurrect'
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-strategy-nvim 'session'
set -g @plugin 'tmux-plugins/tmux-resurrect'

set -g @continuum-restore 'on'
set -g @plugin 'tmux-plugins/tmux-continuum'

# Defaults
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",*:RGB"
set -g mouse on
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
set -g history-limit 10000
set -g escape-time 0
set -g focus-events on
set -g set-clipboard on
setw -g aggressive-resize on
set -g detach-on-destroy off

# Status bar
set -g status-position bottom
set -g status-interval 2
set -g status-justify centre
set -g status-left-length 100
set -g status-right-length 120
set -g window-status-separator ""
set -g status-style "bg=default,fg=default"
set -g status-left "#{?session_locked,#[fg=red]LOCKED,#{?pane_in_mode,#[fg=green]SCROLL,#{?client_prefix,#[fg=cyan]TMUX,#[fg=yellow]NORMAL}}}#[default] #[fg=brightblack]| #[fg=cyan]#S #[fg=brightblack]| "
set -g window-status-format "#[fg=brightblack] #I:#W "
set -g window-status-current-format "#[fg=cyan,bold] #I:#W#{?window_zoomed_flag, [Z],} "
set -g status-right "#[fg=brightblack]| #[fg=green]#(cd '#{pane_current_path}' 2>/dev/null && (git branch --show-current 2>/dev/null || printf 'detached') | tr -d '\n') #[fg=white]local#[fg=brightblack]:#[fg=red]main #[fg=brightblack]| #[fg=blue]#(TZ=America/New_York date '+%A, %d %b %Y %H:%M') "
set -g pane-border-style "fg=brightblack"
set -g pane-active-border-style "fg=blue"
set -g message-style "bg=default,fg=blue"
set -g message-command-style "bg=default,fg=blue"
set -g mode-style "bg=blue,fg=black"
setw -g clock-mode-colour blue

# Reload config
bind M-r source-file ~/.config/tmux/tmux.conf \; display-message "tmux config reloaded"

# Rename window / session / pane
bind , command-prompt -I "#W" "rename-window -- '%%'"
bind . command-prompt -p "Pane title" "select-pane -T '%%'"
bind R command-prompt -I "#S" "rename-session -- '%%'"

# Scrollback and search (zellij scroll/search modes)
setw -g mode-keys vi
bind [ copy-mode -u
bind / command-prompt -p "Search forward" "copy-mode \; send -X search-forward '%%'"
bind ? command-prompt -p "Search backward" "copy-mode \; send -X search-backward '%%'"
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi V send -X select-line
bind -T copy-mode-vi y send -X copy-selection-and-cancel
bind -T copy-mode-vi Escape send -X cancel
bind -T copy-mode-vi n send -X search-again
bind -T copy-mode-vi N send -X search-reverse
bind -T copy-mode-vi g send -X start-of-buffer
bind -T copy-mode-vi G send -X end-of-buffer
bind -T copy-mode-vi C-b send -X page-up
bind -T copy-mode-vi C-f send -X page-down
bind -T copy-mode-vi C-u send -X halfpage-up
bind -T copy-mode-vi C-d send -X halfpage-down
bind -T copy-mode-vi / command-prompt -p "Search forward" "send -X search-forward '%%'"
bind -T copy-mode-vi '?' command-prompt -p "Search backward" "send -X search-backward '%%'"
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-selection-and-cancel

# Pane resizing (Shift-arrows + modal resize mode)
bind r switch-client -T resize-mode \; display-message "Resize mode (h/j/k/l, Esc to exit)"
bind -r -T resize-mode h resize-pane -L 3
bind -r -T resize-mode j resize-pane -D 3
bind -r -T resize-mode k resize-pane -U 3
bind -r -T resize-mode l resize-pane -R 3
bind -T resize-mode Escape switch-client -T prefix
bind -T resize-mode Enter switch-client -T prefix
bind -T resize-mode Space switch-client -T prefix

# Pane movement helper
bind m display-panes -d 2000 \; command-prompt -p "Move active pane to target" "move-pane -t '%%'"

# Splits and new windows inherit the current directory
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind t new-window -c "#{pane_current_path}"
bind C new-session

# Session + window controls (zellij tmux mode parity)
bind s choose-tree -Zw
bind n next-window
bind p previous-window
bind d detach-client
bind x kill-pane
bind X kill-session
bind z resize-pane -Z
bind $ if-shell -F '#{window_synchronize_panes}' 'setw synchronize-panes off \; display-message "Sync panes off"' 'setw synchronize-panes on \; display-message "Sync panes on"'
bind L lock-session

run '~/.config/tmux/plugins/tpm/tpm'
